<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Synapse ‚Äî AI Answer Engine</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --surface2: #1a1a24;
    --border: #ffffff12;
    --accent: #7c6dff;
    --accent2: #ff6b9d;
    --accent3: #00d4aa;
    --text: #e8e8f0;
    --muted: #6b6b80;
    --danger: #ff4d6d;
  }

  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'DM Mono', monospace; overflow-x: hidden; }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 20% 10%, #7c6dff18 0%, transparent 60%),
      radial-gradient(ellipse 60% 50% at 80% 80%, #ff6b9d12 0%, transparent 60%),
      radial-gradient(ellipse 50% 40% at 60% 30%, #00d4aa0a 0%, transparent 50%);
    pointer-events: none; z-index: 0;
  }

  .container { position: relative; z-index: 1; max-width: 860px; margin: 0 auto; padding: 0 24px; }

  header { padding: 40px 0 20px; animation: fadeDown 0.6s ease; }

  .logo {
    font-family: 'Syne', sans-serif; font-size: 28px; font-weight: 800; letter-spacing: -1px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }
  .logo span { font-weight: 400; font-size: 13px; color: var(--muted); -webkit-text-fill-color: var(--muted); font-family: 'DM Mono', monospace; margin-left: 8px; letter-spacing: 0; vertical-align: middle; }
  .tagline { font-size: 11px; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-top: 4px; }

  /* SEARCH */
  .search-wrapper { margin: 48px 0 40px; animation: fadeUp 0.7s ease 0.1s both; }
  .search-box {
    display: flex; align-items: center;
    background: var(--surface); border: 1px solid var(--border); border-radius: 16px;
    transition: border-color 0.3s, box-shadow 0.3s; overflow: hidden;
  }
  .search-box:focus-within { border-color: var(--accent); box-shadow: 0 0 0 3px #7c6dff20, 0 20px 60px #7c6dff15; }
  .search-icon { padding: 0 16px 0 20px; color: var(--muted); font-size: 18px; }
  #searchInput {
    flex: 1; background: transparent; border: none; outline: none;
    font-family: 'DM Mono', monospace; font-size: 15px; color: var(--text);
    padding: 20px 0; caret-color: var(--accent);
  }
  #searchInput::placeholder { color: var(--muted); }
  .search-btn {
    margin: 8px; padding: 12px 24px;
    background: linear-gradient(135deg, var(--accent), #9b8aff);
    border: none; border-radius: 10px; color: white;
    font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700;
    letter-spacing: 0.5px; cursor: pointer; transition: all 0.2s; white-space: nowrap;
  }
  .search-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 25px #7c6dff40; }
  .search-btn:active { transform: translateY(0); }
  .search-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* TABS */
  .tabs-wrapper { display: none; animation: fadeUp 0.5s ease both; }
  .tabs-wrapper.visible { display: block; }
  .tab-bar {
    display: flex; gap: 4px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 4px; margin-bottom: 20px; width: fit-content;
  }
  .tab-btn {
    padding: 10px 22px; border-radius: 8px; border: none;
    background: transparent; color: var(--muted);
    font-family: 'DM Mono', monospace; font-size: 12px;
    cursor: pointer; transition: all 0.25s; letter-spacing: 0.5px;
  }
  .tab-btn.active { background: var(--surface2); color: var(--text); box-shadow: 0 2px 12px #00000040; }
  .tab-btn .dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 8px; background: var(--accent); vertical-align: middle; }
  .tab-btn:nth-child(2) .dot { background: var(--accent2); }
  .tab-btn:nth-child(3) .dot { background: var(--accent3); }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* PANELS */
  .panel { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 28px; margin-bottom: 16px; }
  .panel-label {
    font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 600;
    letter-spacing: 2px; text-transform: uppercase; color: var(--muted);
    margin-bottom: 16px; display: flex; align-items: center; gap: 8px;
  }
  .panel-label::before { content: ''; display: inline-block; width: 20px; height: 1px; background: var(--accent); }

  /* LOADING */
  .typing-indicator { display: none; gap: 4px; padding: 20px 0; align-items: center; }
  .typing-indicator.visible { display: flex; }
  .typing-indicator span { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; animation: bounce 1.2s infinite; }
  .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
  .typing-indicator span:nth-child(3) { animation-delay: 0.4s; background: var(--accent2); }
  .typing-indicator .label { margin-left: 10px; font-size: 12px; color: var(--muted); }

  /* AI ANSWER */
  .source-badge {
    display: inline-flex; align-items: center; gap: 6px;
    background: #7c6dff15; border: 1px solid #7c6dff30;
    border-radius: 20px; padding: 4px 12px; font-size: 11px; color: var(--accent); margin-bottom: 16px;
  }
  .ai-answer-text { line-height: 1.8; font-size: 14px; color: var(--text); white-space: pre-wrap; word-break: break-word; }
  .context-text { font-size: 12px; color: var(--muted); line-height: 1.7; max-height: 200px; overflow-y: auto; white-space: pre-wrap; }
  .context-text::-webkit-scrollbar { width: 4px; }
  .context-text::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* EXPECTED ANSWER */
  .expected-textarea {
    width: 100%; background: var(--surface2); border: 1px solid var(--border);
    border-radius: 12px; padding: 16px; color: var(--text);
    font-family: 'DM Mono', monospace; font-size: 13px; line-height: 1.7;
    resize: vertical; min-height: 140px; outline: none; transition: border-color 0.3s;
  }
  .expected-textarea:focus { border-color: var(--accent2); }
  .expected-textarea::placeholder { color: var(--muted); }
  .score-btn {
    margin-top: 16px; padding: 14px 32px; width: 100%;
    background: linear-gradient(135deg, var(--accent2), #ff8fab);
    border: none; border-radius: 10px; color: white;
    font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700;
    letter-spacing: 0.5px; cursor: pointer; transition: all 0.2s;
  }
  .score-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 25px #ff6b9d40; }
  .score-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  /* SCORE */
  .score-display { display: none; }
  .score-display.visible { display: block; }
  .score-hero { display: flex; align-items: center; gap: 32px; margin-bottom: 28px; flex-wrap: wrap; }
  .score-circle { position: relative; width: 110px; height: 110px; flex-shrink: 0; }
  .score-circle svg { transform: rotate(-90deg); width: 110px; height: 110px; }
  .score-circle .track { fill: none; stroke: var(--surface2); stroke-width: 8; }
  .score-circle .fill { fill: none; stroke-width: 8; stroke-linecap: round; stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 1.5s cubic-bezier(0.22,1,0.36,1); }
  .score-number { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); font-family: 'Syne', sans-serif; font-size: 28px; font-weight: 800; }
  .score-info { flex: 1; }
  .verdict-badge { display: inline-block; padding: 6px 16px; border-radius: 20px; font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; margin-bottom: 12px; }
  .score-feedback { font-size: 13px; line-height: 1.7; color: #b0b0c0; }
  .dimensions { display: grid; gap: 12px; }
  .dim-row { display: flex; align-items: center; gap: 12px; }
  .dim-label { font-size: 11px; color: var(--muted); width: 140px; flex-shrink: 0; text-transform: uppercase; letter-spacing: 0.5px; }
  .dim-bar-wrap { flex: 1; height: 6px; background: var(--surface2); border-radius: 3px; overflow: hidden; }
  .dim-bar { height: 100%; border-radius: 3px; width: 0%; transition: width 1.2s cubic-bezier(0.22,1,0.36,1); }
  .dim-score { font-size: 12px; color: var(--text); width: 30px; text-align: right; }
  .match-badge { display: inline-flex; align-items: center; gap: 6px; font-size: 11px; padding: 4px 10px; border-radius: 20px; margin-left: 8px; font-family: 'DM Mono', monospace; }
  .match-yes { background: #00d4aa15; border: 1px solid #00d4aa30; color: var(--accent3); }
  .match-no  { background: #ff4d6d15; border: 1px solid #ff4d6d30; color: var(--danger); }

  /* EMPTY STATE */
  .empty-state { text-align: center; padding: 80px 20px; animation: fadeUp 0.6s ease 0.2s both; }
  .empty-state .big-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.4; }
  .empty-state h2 { font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 700; margin-bottom: 8px; }
  .empty-state p { font-size: 13px; color: var(--muted); max-width: 360px; margin: 0 auto; line-height: 1.7; }
  .feature-pills { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 24px; }
  .pill { padding: 6px 14px; border-radius: 20px; border: 1px solid var(--border); font-size: 11px; color: var(--muted); background: var(--surface); }

  /* SCORE TAB PLACEHOLDER */
  .score-placeholder { text-align: center; padding: 40px; color: var(--muted); font-size: 13px; line-height: 1.7; }

  /* ANIMATIONS */
  @keyframes fadeDown { from { opacity: 0; transform: translateY(-12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeUp   { from { opacity: 0; transform: translateY(16px);  } to { opacity: 1; transform: translateY(0); } }
  @keyframes bounce   { 0%,60%,100% { transform: translateY(0); opacity: 0.4; } 30% { transform: translateY(-8px); opacity: 1; } }
</style>
</head>
<body>
<div class="container">

  <header>
    <div class="logo">Synapse <span>// AI Answer Engine</span></div>
    <div class="tagline">Search ¬∑ Compare ¬∑ Score ¬∑ Verify</div>
  </header>

  <div class="search-wrapper">
    <div class="search-box">
      <div class="search-icon">‚åï</div>
      <input id="searchInput" type="text" placeholder="Ask anything... e.g. What is quantum entanglement?" autocomplete="off"/>
      <button class="search-btn" id="searchBtn" onclick="doSearch()">Search ‚Üí</button>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" id="emptyState">
    <div class="big-icon">‚óà</div>
    <h2>AI-Powered Search with Answer Scoring</h2>
    <p>Ask any question. Optionally provide your expected answer. Synapse uses Gemini + web search and scores how close the AI gets.</p>
    <div class="feature-pills">
      <span class="pill">üåê Web Search Context</span>
      <span class="pill">ü§ñ Google Gemini</span>
      <span class="pill">üìä Answer Scoring</span>
      <span class="pill">‚úì Accuracy Check</span>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs-wrapper" id="tabsWrapper">
    <div class="tab-bar">
      <button class="tab-btn active" onclick="switchTab('ai')"><span class="dot"></span>AI Answer</button>
      <button class="tab-btn" onclick="switchTab('expected')"><span class="dot"></span>Your Answer</button>
      <button class="tab-btn" onclick="switchTab('score')"><span class="dot"></span>Score</button>
    </div>

    <!-- Tab 1: AI Answer -->
    <div class="tab-panel active" id="tab-ai">
      <div class="panel">
        <div class="panel-label">Gemini Response</div>
        <div class="typing-indicator" id="typingIndicator">
          <span></span><span></span><span></span>
          <span class="label">Searching web & generating answer...</span>
        </div>
        <div id="aiAnswerContent"></div>
      </div>
      <div class="panel" id="webContextPanel" style="display:none;">
        <div class="panel-label">Web Context Used</div>
        <div class="context-text" id="webContextText"></div>
      </div>
    </div>

    <!-- Tab 2: Your Answer -->
    <div class="tab-panel" id="tab-expected">
      <div class="panel">
        <div class="panel-label">Your Expected Answer</div>
        <p style="font-size:12px;color:var(--muted);margin-bottom:16px;line-height:1.7;">
          What answer were you expecting? This will be compared against the AI's answer to generate a score.
        </p>
        <textarea class="expected-textarea" id="expectedAnswer"
          placeholder="Type what you expected the AI to answer...&#10;&#10;e.g. Quantum entanglement is a phenomenon where two particles become correlated and the state of one instantly influences the other, regardless of distance..."></textarea>
        <button class="score-btn" id="scoreBtn" onclick="doScore()" disabled>‚óà Compare & Score ‚Üí</button>
      </div>
    </div>

    <!-- Tab 3: Score -->
    <div class="tab-panel" id="tab-score">
      <div class="panel">
        <div class="panel-label">Answer Analysis</div>
        <div id="scorePlaceholder" class="score-placeholder">
          Complete the <strong style="color:var(--text)">"Your Answer"</strong> tab first, then click Compare & Score.
        </div>
        <div class="score-display" id="scoreDisplay">
          <div class="score-hero">
            <div class="score-circle">
              <svg viewBox="0 0 100 100">
                <circle class="track" cx="50" cy="50" r="45"/>
                <circle class="fill" id="scoreFill" cx="50" cy="50" r="45"/>
              </svg>
              <div class="score-number" id="scoreNumber">0</div>
            </div>
            <div class="score-info">
              <div>
                <span class="verdict-badge" id="verdictBadge">‚Äî</span>
                <span class="match-badge" id="matchBadge"></span>
              </div>
              <div class="score-feedback" id="scoreFeedback"></div>
            </div>
          </div>
          <div class="dimensions" id="dimensionsArea"></div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  let currentAiAnswer = '';
  let currentQuery = '';

  function switchTab(tab) {
    document.querySelectorAll('.tab-btn').forEach((b, i) => {
      b.classList.toggle('active', ['ai','expected','score'][i] === tab);
    });
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.add('active');
  }

  async function doSearch() {
    const query = document.getElementById('searchInput').value.trim();
    if (!query) return;
    currentQuery = query;
    currentAiAnswer = '';

    document.getElementById('emptyState').style.display = 'none';
    document.getElementById('tabsWrapper').classList.add('visible');
    switchTab('ai');

    document.getElementById('typingIndicator').classList.add('visible');
    document.getElementById('aiAnswerContent').innerHTML = '';
    document.getElementById('webContextPanel').style.display = 'none';
    document.getElementById('searchBtn').disabled = true;
    document.getElementById('scoreBtn').disabled = true;
    document.getElementById('scoreDisplay').classList.remove('visible');
    document.getElementById('scorePlaceholder').style.display = 'block';
    document.getElementById('scorePlaceholder').innerHTML = 'Complete the <strong style="color:var(--text)">\"Your Answer\"</strong> tab first, then click Compare & Score.';

    try {
      const res = await fetch('/search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query })
      });
      const data = await res.json();
      document.getElementById('typingIndicator').classList.remove('visible');

      if (data.ai_answer) {
        currentAiAnswer = data.ai_answer;
        document.getElementById('aiAnswerContent').innerHTML = `
          <div class="source-badge">ü§ñ Google Gemini &nbsp;¬∑&nbsp; üåê DuckDuckGo Web</div>
          <div class="ai-answer-text">${escapeHtml(data.ai_answer)}</div>`;
        document.getElementById('scoreBtn').disabled = false;
      }

      if (data.web_context && data.web_context !== 'No web results found.') {
        document.getElementById('webContextText').textContent = data.web_context;
        document.getElementById('webContextPanel').style.display = 'block';
      }
    } catch (err) {
      document.getElementById('typingIndicator').classList.remove('visible');
      document.getElementById('aiAnswerContent').innerHTML =
        `<div style="color:var(--danger);font-size:13px;">Error: ${err.message}</div>`;
    }
    document.getElementById('searchBtn').disabled = false;
  }

  async function doScore() {
    const expected = document.getElementById('expectedAnswer').value.trim();
    if (!expected || !currentAiAnswer) return;

    switchTab('score');
    document.getElementById('scorePlaceholder').innerHTML =
      '<div style="padding:20px;font-size:12px;color:var(--muted);">‚è≥ AI is evaluating answers...</div>';
    document.getElementById('scorePlaceholder').style.display = 'block';
    document.getElementById('scoreDisplay').classList.remove('visible');

    try {
      const res = await fetch('/score', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query: currentQuery, ai_answer: currentAiAnswer, expected_answer: expected })
      });
      const data = await res.json();
      renderScore(data);
    } catch (err) {
      document.getElementById('scorePlaceholder').innerHTML =
        `<div style="color:var(--danger);font-size:13px;">Scoring error: ${err.message}</div>`;
    }
  }

  function renderScore(data) {
    const score = data.total_score || 0;
    document.getElementById('scorePlaceholder').style.display = 'none';
    document.getElementById('scoreDisplay').classList.add('visible');

    const color = score >= 80 ? '#00d4aa' : score >= 60 ? '#7c6dff' : score >= 40 ? '#ffb347' : '#ff4d6d';
    const fill = document.getElementById('scoreFill');
    fill.style.stroke = color;
    setTimeout(() => { fill.style.strokeDashoffset = 283 - (score / 100) * 283; }, 50);
    animateNumber('scoreNumber', 0, score, 1400);

    const vb = document.getElementById('verdictBadge');
    vb.textContent = data.verdict || '‚Äî';
    const vc = { Excellent: '#00d4aa', Good: '#7c6dff', Acceptable: '#ffb347', Poor: '#ff4d6d' }[data.verdict] || '#7c6dff';
    vb.style.cssText = `background:${vc}20;border:1px solid ${vc}40;color:${vc};border-radius:20px;padding:6px 16px;`;

    const mb = document.getElementById('matchBadge');
    mb.textContent = data.matches_expected ? '‚úì Matches expectation' : '‚úó Differs from expectation';
    mb.className = 'match-badge ' + (data.matches_expected ? 'match-yes' : 'match-no');

    document.getElementById('scoreFeedback').textContent = data.feedback || '';

    const dims = [
      { label: 'Factual Accuracy', key: 'factual_accuracy', max: 25 },
      { label: 'Completeness',     key: 'completeness',     max: 25 },
      { label: 'Relevance',        key: 'relevance',        max: 25 },
      { label: 'Clarity',          key: 'clarity',          max: 25 },
    ];
    document.getElementById('dimensionsArea').innerHTML = dims.map(d => {
      const val = data[d.key] || 0;
      const pct = (val / d.max) * 100;
      const bc = pct >= 80 ? '#00d4aa' : pct >= 60 ? '#7c6dff' : pct >= 40 ? '#ffb347' : '#ff4d6d';
      return `<div class="dim-row">
        <div class="dim-label">${d.label}</div>
        <div class="dim-bar-wrap"><div class="dim-bar" id="bar-${d.key}" style="background:${bc}"></div></div>
        <div class="dim-score">${val}/${d.max}</div>
      </div>`;
    }).join('');
    setTimeout(() => {
      dims.forEach(d => {
        const el = document.getElementById('bar-' + d.key);
        if (el) el.style.width = ((data[d.key] || 0) / d.max * 100) + '%';
      });
    }, 100);
  }

  function animateNumber(id, start, end, duration) {
    const el = document.getElementById(id);
    const t0 = performance.now();
    (function step(now) {
      const t = Math.min((now - t0) / duration, 1);
      el.textContent = Math.round(start + (end - start) * (1 - Math.pow(1 - t, 3)));
      if (t < 1) requestAnimationFrame(step);
    })(t0);
  }

  function escapeHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  document.getElementById('searchInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') doSearch();
  });
</script>
</body>
</html>